<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A Special Surprise</title>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Great+Vibes&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root { --pink: #ffafcc; --text-color: #5e548e; --wrong-red: #ffccd5; --right-green: #b9fbc0; }
        * { box-sizing: border-box; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; font-family: 'Quicksand', sans-serif; background: #ffc8dd; display: flex; justify-content: center; align-items: center; }
        
        #lineCanvas { position: fixed; top: 0; left: 0; z-index: 1; width: 100%; height: 100%; }
        #musicSymbolsCanvas { position: fixed; top: 0; left: 0; z-index: 2; width: 100%; height: 100%; pointer-events: none; opacity: 0; transition: opacity 0.5s; }

        .container {
            background: rgba(255, 255, 255, 0.9);
            padding: 2rem; border-radius: 30px; width: 90%; max-width: 400px; text-align: center;
            position: relative; z-index: 10; backdrop-filter: blur(10px);
            border: 4px solid white; box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        h1 { font-family: 'Great Vibes', cursive; color: var(--text-color); font-size: 2.2rem; margin: 0 0 15px; }
        h2 { font-family: 'Dancing Script', cursive; color: #ff4d6d; font-size: 1.8rem; margin: 0 0 10px; }
        p { font-weight: 700; color: var(--text-color); margin-bottom: 20px; }

        .page { display: none; }
        .active { display: block; animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .options-grid { display: flex; flex-direction: column; gap: 10px; margin-top: 15px; min-height: 250px; position: relative; }
        button {
            width: 100%; padding: 12px; border: 2px solid #ffccd5; background: white;
            border-radius: 15px; cursor: pointer; transition: 0.2s; color: var(--text-color);
            font-family: 'Quicksand', sans-serif; font-weight: 700; font-size: 0.95rem;
        }
        
        .shake { animation: shake 0.4s ease-in-out; background-color: var(--wrong-red) !important; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }

        .particle { position: absolute; border-radius: 50%; pointer-events: none; z-index: 999; }
        .cracker { position: absolute; width: 4px; height: 15px; border-radius: 2px; pointer-events: none; z-index: 999; }
        
        .letter-paper { background: #fff; padding: 15px; border-radius: 10px; font-family: 'Dancing Script', cursive; font-size: 1.2rem; text-align: left; border: 1px solid #eee; }
        .gift-item { font-size: 50px; cursor: pointer; display: inline-block; margin: 10px; animation: wobble 2s infinite; }
        @keyframes wobble { 0%, 100% { transform: rotate(0); } 50% { transform: rotate(5deg); } }
    </style>
</head>
<body>

<canvas id="lineCanvas"></canvas>
<canvas id="musicSymbolsCanvas"></canvas>

<div class="container">
    <audio id="bgMusic" loop><source src="music.mp3.mp3" type="audio/mpeg"></audio>

    <div id="instruction-page" class="page active">
        <h1>Hyy Archana Madhu! üå∏</h1>
        <p>1 Wrong = 2 Bad Photos üì∏<br>Score 20/20 to unlock surprise!</p>
        <button onclick="startQuiz()">I'm Ready! ‚ú®</button>
    </div>

    <div id="quiz-area"></div>

    <div id="result-page" class="page">
        <h2>Results!</h2>
        <p id="result-text"></p>
        <button id="gift-btn" style="display:none;"></button>
    </div>

    <div id="penalty-page" class="page">
        <h2>Hold on Babbyy! üõë</h2>
        <p id="penalty-stats"></p>
        <p style="font-size: 0.8rem; color: #ff4d6d;">(Grand Total from all retries!)</p>
        <p>Promise your bf that you will accept the penalty then only he gives you the pass code</p>
        <button onclick="goToLockPage()">I Promise ‚ù§Ô∏è</button>
    </div>

    <div id="lock-page" class="page">
        <h2>Security Check üîí</h2>
        <input type="password" id="masterPass" placeholder="Enter Password">
        <button onclick="checkMasterPass()">Unlock ‚ú®</button>
        <p id="pass-error" style="color:red; display:none;">Wrong Password!</p>
    </div>

    <div id="gift-page" class="page">
        <h2 style="font-family: 'Great Vibes';">Happy Valentine's Day!</h2>
        <div id="gift-selection">
            <div class="gift-item" onclick="openView('letter-view')">üíå</div>
            <div class="gift-item" onclick="openView('music-view', true)">üéµ</div>
            <div class="gift-item" onclick="openView('password-view')">üéÅ</div>
        </div>

        <div id="letter-view" style="display:none;">
            <div class="letter-paper" id="typed-letter"></div>
            <button onclick="backToGifts()" style="margin-top:10px; width:auto;">Back</button>
        </div>

        <div id="music-view" style="display:none;">
            <p>You are my favorite song! ‚ù§Ô∏è</p>
            <button onclick="backToGifts()" style="width:auto;">Back</button>
        </div>

        <div id="password-view" style="display:none;">
            <p>Secret Gift Pass:</p>
            <h3 style="color:#ff4d6d;">Archanamadhu@7736</h3>
            <button onclick="backToGifts()" style="width:auto;">Back</button>
        </div>
    </div>
</div>

<script>
    const canvas = document.getElementById('lineCanvas');
    const ctx = canvas.getContext('2d');
    const musicCanvas = document.getElementById('musicSymbolsCanvas');
    const mctx = musicCanvas.getContext('2d');

    let score = 0, currentIdx = 0, totalWrongCumulative = 0;
    const colors = ['#ffafcc', '#bde0fe', '#ffc8dd', '#b9fbc0'];
    const music = document.getElementById('bgMusic');

    const rawQuestions = [
        {q: "What am I to you?", a: ["All of these", "My comfort", "Special person", "Most fav person ever"]},
        {q: "Which of our dates will always be your favourite?", a: ["Tvm Cafee", "kadhal cafe", "Coocon", "Ayushus"]},
        {q: "Which outfits did I like you wearing the most?", a: ["All of these (bzc its you)", "Casual Outfits", "Traditional Outfits", "The Hot Outfits"]},
        {q: "Which day do you think I still remember clearly?", a: ["Tvm Days", "Kadhal Cafe", "Coocon", "Ayushus"]},
        {q: "When I looked at you first day, what did I feel?", a: ["Fully Nervous", "Calm", "Shy", "Happyy"]},
        {q: "What is my favorite Food?", a: ["Youhh", "Alfamm", "Mandhi", "Momos and orange Juice"]},
        {q: "Who is more annoying?", a: ["Definitely You", "Me", "Both of us", "Neither"]},
        {q: "What is my favorite thing about you?", a: ["Everything!", "Your Eyes", "Your Smile", "Effortless Movement"]},
        {q: "Which is my fav thing you says?", a: ["Entha Bibinneee", "Bibinee", "Babbyyy", "Poddaaa"]},
        {q: "Do you love me?", a: ["YESSS!", "No", "Maybe", "I'll think about it"]},
        {q: "What is the one thing I can't live without?", a: ["Your presence", "My Phone", "Football", "Sleep"]},
        {q: "Who is you fav njn ahno atho?", a: ["Youh babbyy", "Shrishitha", "Sandra", "Fidha"]},
        {q: "What is my favorite nickname for you?", a: ["Madhute Mole", "Product", "Babbyy", "Object"]},
        {q: "Which is your fav thing i done for youhh?", a: ["All the things I done", "Hand placements", "Effortless Movement", "Squeezing"]},
        {q: "Which is my fav colour, While we are in Trivandram?", a: ["Orange", "Black", "Yellow", "Blue"]},
        {q: "Which is my fav Outfits that I will not Forget in my entire life?", a: ["Pink Kurthi", "Crop tops", "Saree", "Nightdress"]},
        {q: "Give me the permission for doing kollathillatharam everyday while you are with me?", a: ["Yes Babbyy You can do anything without my permission", "No babbyyy", "Why Should I", "May be"]},
        {q: "What do I want from you forever?", a: ["Kollathilatharam", "Gifts", "Treats", "Dates"]},
        {q: "Are you the best thing that ever happened to me?", a: ["Without a doubt, YES!", "Maybe", "Second best", "I'm not sure"]},
        {q: "Will you be my Valentine?", a: ["YES!", "No way"], special: true}
    ];

    let activeQuestions = [];

    function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
    window.addEventListener('resize', resize); resize();

    function startQuiz() {
        activeQuestions = [...rawQuestions].sort(() => Math.random() - 0.5);
        currentIdx = 0; score = 0;
        document.getElementById('instruction-page').classList.remove('active');
        document.getElementById('result-page').classList.remove('active');
        showQuestion();
    }

    function showQuestion() {
        const quizArea = document.getElementById('quiz-area');
        quizArea.innerHTML = "";
        const data = activeQuestions[currentIdx];
        
        const page = document.createElement('div');
        page.className = "page active";
        page.innerHTML = `<h2>Q${currentIdx + 1}</h2><p>${data.q}</p>`;
        
        const grid = document.createElement('div');
        grid.className = "options-grid";
        if(data.special) grid.id = "q20-grid";

        let options = data.a.map((text, i) => ({text, correct: i === 0}));
        if(!data.special) options.sort(() => Math.random() - 0.5);

        options.forEach(opt => {
            const btn = document.createElement('button');
            btn.innerText = opt.text;
            if(data.special && !opt.correct) {
                btn.id = "noButton"; btn.onmouseover = moveNoButton;
            } else if (data.special && opt.correct) {
                btn.onclick = () => finalYes(btn);
            } else {
                btn.onclick = () => handleAnswer(btn, opt.correct);
            }
            grid.appendChild(btn);
        });
        page.appendChild(grid);
        quizArea.appendChild(page);
    }

    function handleAnswer(btn, isCorrect) {
        if(isCorrect) {
            score++; btn.style.backgroundColor = "#b9fbc0";
        } else {
            btn.classList.add('shake'); totalWrongCumulative++;
        }
        setTimeout(() => {
            currentIdx++;
            if(currentIdx < activeQuestions.length) showQuestion();
            else showResult();
        }, 500);
    }

    function showResult() {
        document.getElementById('quiz-area').innerHTML = "";
        const resPage = document.getElementById('result-page');
        resPage.classList.add('active');
        const text = document.getElementById('result-text');
        const giftBtn = document.getElementById('gift-btn');
        giftBtn.style.display = 'block';

        if (score === 20) {
            text.innerText = "20/20! You're perfect! ‚ù§Ô∏è";
            giftBtn.innerText = "Proceed to Surprise";
            giftBtn.onclick = () => {
                resPage.classList.remove('active');
                document.getElementById('penalty-page').classList.add('active');
                document.getElementById('penalty-stats').innerHTML = `Total Mistakes: ${totalWrongCumulative}<br>Photos Owed: ${totalWrongCumulative * 2}`;
            };
        } else {
            text.innerText = `Score: ${score}/20. Mistakes so far: ${totalWrongCumulative}`;
            giftBtn.innerText = "Restart (Shuffled)";
            giftBtn.onclick = startQuiz;
        }
    }

    function moveNoButton() {
        const btn = document.getElementById('noButton');
        btn.style.position = "absolute";
        btn.style.left = Math.random() * 70 + "%";
        btn.style.top = Math.random() * 70 + "%";
    }

    function finalYes(btn) {
        score++; btn.style.backgroundColor = "#b9fbc0";
        setTimeout(showResult, 1000);
    }

    function goToLockPage() { document.getElementById('penalty-page').classList.remove('active'); document.getElementById('lock-page').classList.add('active'); }
    function checkMasterPass() { 
        if(document.getElementById('masterPass').value === "Bibin@2005") {
            document.getElementById('lock-page').classList.remove('active');
            document.getElementById('gift-page').classList.add('active');
        } else { document.getElementById('pass-error').style.display = "block"; }
    }

    function openView(id, m) { 
        document.getElementById('gift-selection').style.display = 'none';
        document.getElementById(id).style.display = 'block';
        if(id === 'letter-view') typeL();
        if(m) { music.play(); musicCanvas.style.opacity = "1"; }
    }

    function backToGifts() {
        ['letter-view', 'music-view', 'password-view'].forEach(id => document.getElementById(id).style.display = 'none');
        document.getElementById('gift-selection').style.display = 'block';
    }

    function typeL() {
        const t = "My Dearest Archana,\n\nYou are my favorite person. Happy Valentine's Day! ‚ù§Ô∏è";
        const el = document.getElementById('typed-letter'); el.innerHTML = "";
        let i = 0; const int = setInterval(() => {
            if(i < t.length) { el.innerHTML += t[i] === '\n' ? '<br>' : t[i]; i++; }
            else clearInterval(int);
        }, 50);
    }
</script>
</body>
</html>
