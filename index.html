<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A Special Surprise for You</title>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Poppins:wght@300;400;600&family=Great+Vibes&family=Quicksand:wght@500;700&family=Montserrat:wght@600&display=swap" rel="stylesheet">
    <style>
        :root {
            --pink: #ffafcc;
            --text-color: #5e548e;
            --wrong-red: #ffccd5; 
            --right-green: #b9fbc0;
        }

        * { box-sizing: border-box; }

        body, html {
            margin: 0; padding: 0;
            width: 100%; height: 100%;
            overflow: hidden;
            font-family: 'Quicksand', sans-serif;
            background: linear-gradient(120deg, #ffafcc, #bde0fe, #ffc8dd, #b9fbc0, #fcf6bd);
            background-size: 400% 400%;
            animation: rainbowBG 15s ease infinite;
            display: flex; justify-content: center; align-items: center;
        }

        @keyframes rainbowBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        #lineCanvas { position: fixed; top: 0; left: 0; z-index: 1; width: 100%; height: 100%; }
        #musicSymbolsCanvas { position: fixed; top: 0; left: 0; z-index: 2; width: 100%; height: 100%; pointer-events: none; opacity: 0; transition: opacity 0.5s; }

        .container {
            background: linear-gradient(-45deg, #ffffff, #fff0f3, #f0f7ff, #ffffff);
            background-size: 300% 300%;
            animation: moveGradient 8s ease infinite;
            padding: 2.5rem 2rem;
            border-radius: 30px;
            width: 90%;
            max-width: 400px;
            text-align: center;
            position: relative;
            z-index: 10;
            backdrop-filter: blur(15px);
            border: 4px solid white; 
            box-shadow: 0 0 15px 5px rgba(255, 255, 255, 0.6), 0 0 20px 2px #ffafcc, 0 0 25px 5px #bde0fe;
        }

        @keyframes moveGradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        h1 { font-family: 'Great Vibes', cursive; color: var(--text-color); margin: 0 0 15px 0; font-size: 2.5rem; }
        h2 { font-family: 'Dancing Script', cursive; color: #ff4d6d; font-size: 2rem; margin-bottom: 10px; }
        p { font-weight: 700; color: var(--text-color); font-size: 1.1rem; margin-bottom: 20px; }

        .page { display: none; }
        .active { display: block; animation: slideIn 0.6s cubic-bezier(0.23, 1, 0.32, 1); }

        @keyframes slideIn { from { transform: translateX(50px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

        .options-grid { display: flex; flex-direction: column; gap: 12px; margin-top: 20px; position: relative; min-height: 280px; }

        button {
            width: 100%; padding: 14px; border: 2px solid #ffccd5;
            background: rgba(255, 255, 255, 0.9); border-radius: 20px;
            cursor: pointer; transition: 0.3s; color: var(--text-color);
            font-family: 'Quicksand', sans-serif; font-weight: 700;
            position: relative; overflow: hidden;
        }
        
        button:hover { 
            background: linear-gradient(45deg, #ffafcc, #bde0fe); 
            color: white; border-color: white; transform: scale(1.03); 
        }

        input[type="password"] {
            width: 100%; padding: 12px; border-radius: 15px; border: 2px solid #ffccd5;
            margin-bottom: 15px; text-align: center; font-family: 'Quicksand', sans-serif; outline: none;
        }

        .shake { animation: shake 0.4s ease-in-out; background-color: var(--wrong-red) !important; color: #b91c1c !important; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-8px); } 75% { transform: translateX(8px); } }

        .particle { position: absolute; border-radius: 50%; pointer-events: none; z-index: 999; }
        .cracker { position: absolute; width: 4px; height: 18px; border-radius: 2px; pointer-events: none; z-index: 999; }

        .valentine-title { font-family: 'Dancing Script', cursive; font-size: 3rem; font-weight: 700; color: #ff4d6d; text-shadow: 2px 2px 4px rgba(0,0,0,0.1); animation: floatText 3s ease-in-out infinite; }
        @keyframes floatText { 0%, 100% { transform: translateY(0) scale(1); } 50% { transform: translateY(-10px) scale(1.05); } }
        .gift-container { display: flex; justify-content: center; gap: 20px; margin: 30px 0; }
        .gift-item { font-size: 60px; cursor: pointer; transition: 0.3s; animation: wobble 2s infinite; }
        @keyframes wobble { 0%, 100% { transform: rotate(0deg); } 25% { transform: rotate(5deg); } 75% { transform: rotate(-5deg); } }
        .letter-view, .password-view, .music-view { display: none; text-align: left; }
        .letter-paper { background: #fff; padding: 20px; border-radius: 15px; font-family: 'Dancing Script', cursive; font-size: 1.4rem; color: #444; margin-bottom: 20px; min-height: 150px; border: 1px solid #eee; }
        .music-text { font-family: 'Montserrat', sans-serif; font-size: 1.2rem; color: #8338ec; line-height: 1.6; font-weight: 600; text-align: center; background: linear-gradient(45deg, #ff4d6d, #8338ec); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .back-icon { font-size: 0.8rem; cursor: pointer; display: inline-block; margin-top: 15px; background: #ffc8dd; padding: 8px 20px; border-radius: 20px; color: white; font-weight: bold; transition: 0.3s; }
        .center-btn { text-align: center; width: 100%; }
        .reveal-pass { opacity: 0; animation: slowShow 2s forwards; }
        @keyframes slowShow { to { opacity: 1; } }
    </style>
</head>
<body>

<canvas id="lineCanvas"></canvas>
<canvas id="musicSymbolsCanvas"></canvas>

<div class="container">
    <audio id="bgMusic" loop><source src="music.mp3.mp3" type="audio/mpeg"></audio>

    <div id="instruction-page" class="page active">
        <h1>Hyy Archana Madhu! üå∏</h1>
        <p>Follow the instructions:</p>
        <div style="text-align: left; margin: 20px 0; color: #777; font-size: 0.9rem;">
            <div>‚ú® 1. 1 Wrong answers = 2 kolathillatha Photos.</div>
            <div>‚ú® 2. Correct all the answers (20/20).</div>
            <div>‚ú® 3. Unlock your Passcode for your surprise</div>
        </div>
        <button onclick="startQuiz()">Babbee Are you Ready! ‚ú®</button>
    </div>

    <div id="q1" class="page"><h2>Question 1</h2><p>What am I to you?</p><div class="options-grid"><button onclick="next(this, true)">All of these</button><button onclick="next(this, false)">My comfort</button><button onclick="next(this, false)">Special person</button><button onclick="next(this, false)">Most fav person ever</button></div></div>
    <div id="q2" class="page"><h2>Question 2</h2><p>Which of our dates will always be your favourite?</p><div class="options-grid"><button onclick="next(this, false)">kadhal cafe</button><button onclick="next(this, true)">Tvm Cafee</button><button onclick="next(this, false)">Coocon</button><button onclick="next(this, false)">Ayushus</button></div></div>
    <div id="q3" class="page"><h2>Question 3</h2><p>Which outfits did I like you wearing the most?</p><div class="options-grid"><button onclick="next(this, false)">Casual Outfits</button><button onclick="next(this, false)">Traditional Outfits</button><button onclick="next(this, true)">All of these (bzc its you)</button><button onclick="next(this, false)">The Hot Outfits</button></div></div>
    <div id="q4" class="page"><h2>Question 4</h2><p>Which day do you think I still remember clearly?</p><div class="options-grid"><button onclick="next(this, true)">Tvm Days</button><button onclick="next(this, false)">Kadhal Cafe</button><button onclick="next(this, false)">Coocon</button><button onclick="next(this, false)">Ayushus</button></div></div>
    <div id="q5" class="page"><h2>Question 5</h2><p>When I looked at you first day, what did I feel?</p><div class="options-grid"><button onclick="next(this, true)">Fully Nervous</button><button onclick="next(this, false)">Calm</button><button onclick="next(this, false)">Shy</button><button onclick="next(this, false)">Happyy</button></div></div>
    <div id="q6" class="page"><h2>Question 6</h2><p>What is my favorite Food?</p><div class="options-grid"><button onclick="next(this, false)">Alfamm</button><button onclick="next(this, true)">Youhh</button><button onclick="next(this, false)">Mandhi</button><button onclick="next(this, false)">Momos and orange Juice</button></div></div>
    <div id="q7" class="page"><h2>Question 7</h2><p>Who is more annoying?</p><div class="options-grid"><button onclick="next(this, false)">Me</button><button onclick="next(this, true)">Definitely You</button><button onclick="next(this, false)">Both of us</button><button onclick="next(this, false)">Neither</button></div></div>
    <div id="q8" class="page"><h2>Question 8</h2><p>What is my favorite thing about you?</p><div class="options-grid"><button onclick="next(this, false)">Your Eyes</button><button onclick="next(this, false)">Your Smile</button><button onclick="next(this, true)">Everything!</button><button onclick="next(this, false)">Effortless Movement</button></div></div>
    <div id="q9" class="page"><h2>Question 9</h2><p>Which is my fav thing you says?</p><div class="options-grid"><button onclick="next(this, false)">Bibinee</button><button onclick="next(this, true)">Entha Bibinneee</button><button onclick="next(this, false)">Babbyyy</button><button onclick="next(this, false)">Poddaaa</button></div></div>
    <div id="q10" class="page"><h2>Question 10</h2><p>Do you love me?</p><div class="options-grid"><button onclick="next(this, true)">YESSS!</button><button onclick="next(this, false)">No</button><button onclick="next(this, false)">Maybe</button><button onclick="next(this, false)">I'll think about it</button></div></div>
    <div id="q11" class="page"><h2>Question 11</h2><p>What is the one thing I can't live without?</p><div class="options-grid"><button onclick="next(this, false)">My Phone</button><button onclick="next(this, true)">Your presence</button><button onclick="next(this, false)">Football</button><button onclick="next(this, false)">Sleep</button></div></div>
    <div id="q12" class="page"><h2>Question 12</h2><p>Who is you fav njn ahno atho?</p><div class="options-grid"><button onclick="next(this, false)">Shrishitha</button><button onclick="next(this, false)">Sandra</button><button onclick="next(this, true)">Youh babbyy</button><button onclick="next(this, false)">Fidha</button></div></div>
    <div id="q13" class="page"><h2>Question 13</h2><p>What is my favorite nickname for you?</p><div class="options-grid"><button onclick="next(this, true)">Madhute Mole</button><button onclick="next(this, false)">Product</button><button onclick="next(this, false)">Babbyy</button><button onclick="next(this, false)">Object</button></div></div>
    <div id="q14" class="page"><h2>Question 14</h2><p>Which is your fav thing i done for youhh?</p><div class="options-grid"><button onclick="next(this, false)">Hand placements</button><button onclick="next(this, true)">All the things I done</button><button onclick="next(this, false)">Effortless Movement</button><button onclick="next(this, false)">Squeezing</button></div></div>
    <div id="q15" class="page"><h2>Question 15</h2><p>Which is my fav colour, While we are in Trivandram?</p><div class="options-grid"><button onclick="next(this, false)">Black</button><button onclick="next(this, false)">Yellow</button><button onclick="next(this, true)">Orange</button><button onclick="next(this, false)">Blue</button></div></div>
    <div id="q16" class="page"><h2>Question 16</h2><p>Which is my fav Outfits that I will not Forget in my entire life?</p><div class="options-grid"><button onclick="next(this, false)">Crop tops</button><button onclick="next(this, true)">Pink Kurthi</button><button onclick="next(this, false)">Saree</button><button onclick="next(this, false)">Nightdress</button></div></div>
    <div id="q17" class="page"><h2>Question 17</h2><p>Give me the permission for doing kollathillatharam everyday while you are with me?</p><div class="options-grid"><button onclick="next(this, false)">No babbyyy</button><button onclick="next(this, true)">Yes Babbyy You can do anything without my permission</button><button onclick="next(this, false)">Why Should I</button><button onclick="next(this, false)">May be</button></div></div>
    <div id="q18" class="page"><h2>Question 18</h2><p>What do I want from you forever?</p><div class="options-grid"><button onclick="next(this, false)">Gifts</button><button onclick="next(this, true)">Kollathilatharam</button><button onclick="next(this, false)">Treats</button><button onclick="next(this, false)">Dates</button></div></div>
    <div id="q19" class="page"><h2>Question 19</h2><p>Are you the best thing that ever happened to me?</p><div class="options-grid"><button onclick="next(this, true)">Without a doubt, YES!</button><button onclick="next(this, false)">Maybe</button><button onclick="next(this, false)">Second best</button><button onclick="next(this, false)">I'm not sure</button></div></div>

    <div id="q20" class="page">
        <h2>Question 20</h2>
        <p>Will you be my Valentine? </p>
        <div class="options-grid" id="q20-grid">
            <button id="yesBtn" onclick="finalYes(this)">YES!</button>
            <button id="noButton" onmouseover="moveNoButton()" onclick="moveNoButton()">No way</button>
        </div>
    </div>

    <div id="result-page" class="page">
        <h2>Results!</h2>
        <p id="result-text"></p>
        <button id="gift-btn" style="display:none;"></button>
    </div>

    <div id="penalty-page" class="page">
        <h2>Hold on Babbyy! üõë</h2>
        <p id="penalty-stats"></p>
        <p style="font-size: 0.8rem; color: #ff4d6d;">(Grand Total: All attempts included!)</p>
        <p>Do you accept this condition to proceed?</p>
        <button onclick="goToLockPage()">I Accept ‚ù§Ô∏è</button>
    </div>

    <div id="lock-page" class="page">
        <h2>Security Checkpoint üîí</h2>
        <p>Promise your bf that you will accept the penalty then only he gives you the pass code</p>
        <input type="password" id="masterPass" placeholder="Enter Password Here">
        <button onclick="checkMasterPass()">Unlock My Surprise ‚ú®</button>
        <p id="pass-error" style="color:red; font-size: 0.8rem; display:none; margin-top:10px;">Oops! Wrong Password Babbyy.</p>
    </div>

    <div id="gift-page" class="page">
        <h1 class="valentine-title">Happy Valentine's Day!</h1>
        <div id="gift-selection">
            <p>You unlocked three surprises, Babbyyy!</p>
            <div class="gift-container">
                <div class="gift-item" onclick="openView('letter-view')">üíå</div>
                <div class="gift-item" onclick="openView('music-view', true)">üéµ</div>
                <div class="gift-item" onclick="openView('password-view')">üéÅ</div>
            </div>
        </div>
        <div id="music-view" class="music-view">
            <div style="text-align: center; margin-top: 20px;">
                <p class="music-text">Every notes reminds me of you. <br> You are my Fav Person And this song is for Youu, Archaneeee. ‚ú®</p>
                <div class="center-btn"><div class="back-icon" onclick="backToGifts()">üå∏ Back</div></div>
            </div>
        </div>
        <div id="letter-view" class="letter-view">
            <div class="letter-paper" id="typed-letter"></div>
            <div class="center-btn"><div class="back-icon" onclick="backToGifts()">üå∏ Back</div></div>
        </div>
        <div id="password-view" class="password-view">
            <div style="text-align: center; margin-top: 20px;">
                <p>Secret Gift Password is:</p>
                <h2 class="reveal-pass" style="color: #ff4d6d; background: white; padding: 10px; border-radius: 10px; border: 2px dashed #ffafcc; margin-bottom: 25px;">Archanamadhu@7736</h2>
                <div class="center-btn"><div class="back-icon" onclick="backToGifts()">üå∏ Back</div></div>
            </div>
        </div>
    </div>
</div>

<script>
    const canvas = document.getElementById('lineCanvas');
    const ctx = canvas.getContext('2d');
    const musicCanvas = document.getElementById('musicSymbolsCanvas');
    const mctx = musicCanvas.getContext('2d');

    let currentStepIndex = 0; 
    let score = 0; 
    let time = 0;
    let totalWrongCumulative = 0; 
    let questionSequence = []; // To store the shuffled order of IDs

    const colors = ['#ffafcc', '#bde0fe', '#ffc8dd', '#fff', '#ff0054', '#8338ec', '#00f2ff', '#ffea00', '#b9fbc0', '#ff70a6', '#70d6ff', '#fb6f92'];
    const music = document.getElementById('bgMusic');

    function resize() { 
        canvas.width = musicCanvas.width = window.innerWidth; 
        canvas.height = musicCanvas.height = window.innerHeight; 
    }
    window.addEventListener('resize', resize); resize();
    
    // Background Animations
    const curveLines = Array.from({length: 60}, () => ({
        yBase: Math.random() * canvas.height, amplitude: Math.random() * 60 + 20,
        frequency: Math.random() * 0.004 + 0.001, speed: Math.random() * 0.015 + 0.005,
        offset: Math.random() * 5000, color: colors[Math.floor(Math.random() * colors.length)],
        width: Math.random() * 2 + 1, opacity: 0.3
    }));
    const straightLines = Array.from({length: 25}, () => ({
        y: Math.random() * canvas.height, speed: Math.random() * 2 + 1,
        width: Math.random() * 1.5 + 0.5, color: colors[Math.floor(Math.random() * colors.length)],
        length: Math.random() * 200 + 50, x: Math.random() * canvas.width
    }));
    const notes = ['‚ô™', '‚ô´', '‚ô¨', '‚ô©', '‚àÆ', '‚ô≠'];
    const musicalParticles = Array.from({length: 45}, () => ({
        x: Math.random() * window.innerWidth, y: Math.random() * window.innerHeight + window.innerHeight,
        text: notes[Math.floor(Math.random() * notes.length)], size: Math.random() * 25 + 20,
        speed: Math.random() * 2 + 1, opacity: Math.random() * 0.6 + 0.4, drift: Math.random() * 2 - 1,
        color: colors[Math.floor(Math.random() * colors.length)]
    }));

    function animate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        mctx.clearRect(0, 0, musicCanvas.width, musicCanvas.height);
        curveLines.forEach(line => {
            ctx.beginPath(); ctx.strokeStyle = line.color; ctx.globalAlpha = line.opacity; ctx.lineWidth = line.width;
            ctx.moveTo(0, line.yBase);
            for (let x = 0; x < canvas.width; x += 20) {
                const y = line.yBase + Math.sin(x * line.frequency + (time * line.speed) + line.offset) * line.amplitude;
                ctx.lineTo(x, y);
            }
            ctx.stroke();
        });
        straightLines.forEach(line => {
            ctx.beginPath(); ctx.strokeStyle = line.color; ctx.globalAlpha = 0.4; ctx.lineWidth = line.width;
            ctx.moveTo(line.x, line.y); ctx.lineTo(line.x + line.length, line.y); ctx.stroke();
            line.x += line.speed; if (line.x > canvas.width) line.x = -line.length;
        });
        musicalParticles.forEach(p => {
            mctx.font = `${p.size}px Arial`; mctx.fillStyle = p.color; mctx.globalAlpha = p.opacity;
            mctx.fillText(p.text, p.x, p.y); p.y -= p.speed; p.x += Math.sin(time * 0.05) * p.drift;
            if (p.y < -50) { p.y = musicCanvas.height + 50; p.x = Math.random() * musicCanvas.width; }
        });
        time += 1; requestAnimationFrame(animate);
    }
    animate();

    // Logic for Shuffling Questions and Options
    function prepareShuffledQuiz() {
        // Create array for Q1 to Q19
        questionSequence = [];
        for (let i = 1; i <= 19; i++) {
            questionSequence.push(`q${i}`);
            
            // Shuffle the options (buttons) inside each question
            const grid = document.querySelector(`#q${i} .options-grid`);
            if (grid) {
                const buttons = Array.from(grid.children);
                for (let j = buttons.length - 1; j > 0; j--) {
                    const k = Math.floor(Math.random() * (j + 1));
                    grid.appendChild(buttons[k]);
                }
            }
        }
        
        // Randomly shuffle the order of Q1-Q19
        for (let i = questionSequence.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [questionSequence[i], questionSequence[j]] = [questionSequence[j], questionSequence[i]];
        }

        // Always add Q20 at the very end
        questionSequence.push('q20');
        
        // Reset button positions for Q20 specially
        const q20NoBtn = document.getElementById('noButton');
        q20NoBtn.style.position = "";
        q20NoBtn.style.left = "";
        q20NoBtn.style.top = "";
    }

    function startQuiz() {
        prepareShuffledQuiz();
        currentStepIndex = 0;
        document.getElementById('instruction-page').classList.remove('active');
        document.getElementById(questionSequence[currentStepIndex]).classList.add('active');
    }

    function next(btn, isCorrect) {
        if(isCorrect) { 
            score++; 
            btn.style.backgroundColor = "#b9fbc0"; 
            createSparkles(35); 
        } else { 
            btn.classList.add('shake'); 
            totalWrongCumulative++;
        }
        setTimeout(() => {
            document.getElementById(questionSequence[currentStepIndex]).classList.remove('active');
            currentStepIndex++; 
            const nextEl = document.getElementById(questionSequence[currentStepIndex]);
            if(nextEl) nextEl.classList.add('active');
        }, 600);
    }

    function finalYes(btn) {
        score++; btn.style.backgroundColor = "#b9fbc0";
        const effectInterval = setInterval(() => { createMegaSpark(30); createCrackers(20); }, 100);
        setTimeout(() => {
            clearInterval(effectInterval);
            document.getElementById(`q20`).classList.remove('active');
            document.getElementById('result-page').classList.add('active');
            showResult();
        }, 3000); 
    }

    function showResult() {
        const text = document.getElementById('result-text');
        const giftBtn = document.getElementById('gift-btn');
        if (score === 20) {
            text.innerText = "Perfect Score 20/20! Archana, you're amazing! ‚ù§Ô∏è";
            giftBtn.style.display = 'block'; giftBtn.innerText = "See the Penalty & Surprise"; 
            giftBtn.onclick = () => {
                document.getElementById('result-page').classList.remove('active');
                document.getElementById('penalty-page').classList.add('active');
                document.getElementById('penalty-stats').innerHTML = `Across all attempts, you clicked <b>${totalWrongCumulative}</b> wrong answers.<br>That means you owe Bibin <b>${totalWrongCumulative * 2}</b> photos!`;
            };
        } else {
            text.innerText = `Babbyy, you need 20/20! You only got ${score}/20 this time. Your current cumulative mistakes: ${totalWrongCumulative}`;
            giftBtn.style.display = 'block'; giftBtn.innerText = "Restart (Mistakes will keep adding up!) üîÑ"; 
            giftBtn.onclick = () => softRestart(); 
        }
    }

    function softRestart() {
        document.getElementById('result-page').classList.remove('active');
        // Clear previous visual states
        document.querySelectorAll('.options-grid button').forEach(b => {
            b.classList.remove('shake');
            b.style.backgroundColor = "";
        });
        score = 0;
        // This will re-shuffle everything again
        startQuiz();
    }

    function moveNoButton() {
        const btn = document.getElementById('noButton');
        const grid = document.getElementById('q20-grid');
        const maxX = grid.clientWidth - btn.offsetWidth;
        const maxY = grid.clientHeight - btn.offsetHeight;
        btn.style.position = "absolute";
        btn.style.left = (Math.random() * maxX) + "px"; 
        btn.style.top = (Math.random() * maxY) + "px";
    }

    function goToLockPage() {
        document.getElementById('penalty-page').classList.remove('active');
        document.getElementById('lock-page').classList.add('active');
    }

    function checkMasterPass() {
        if(document.getElementById('masterPass').value === "Bibin@2005") {
            document.getElementById('lock-page').classList.remove('active');
            document.getElementById('gift-page').classList.add('active');
        } else {
            document.getElementById('pass-error').style.display = "block";
        }
    }

    // Effect functions
    function createSparkles(count) { for (let i = 0; i < count; i++) { const p = document.createElement('div'); p.className = 'particle'; p.style.backgroundColor = colors[Math.floor(Math.random()*colors.length)]; p.style.width = '10px'; p.style.height = '10px'; p.style.left = '50%'; p.style.top = '50%'; document.body.appendChild(p); const dX = (Math.random() - 0.5) * 700, dY = (Math.random() - 0.5) * 700; p.animate([{ opacity: 1, transform: 'scale(1)' }, { opacity: 0, transform: `translate(${dX}px, ${dY}px) scale(0)` }], 1000).onfinish = () => p.remove(); } }
    function createMegaSpark(count) { for (let i = 0; i < count; i++) { const p = document.createElement('div'); p.className = 'particle'; p.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)]; p.style.width = '15px'; p.style.height = '15px'; p.style.left = Math.random() * 100 + '%'; p.style.top = Math.random() * 100 + '%'; document.body.appendChild(p); const dX = (Math.random() - 0.5) * 1500, dY = (Math.random() - 0.5) * 1500; p.animate([{ opacity: 1, transform: 'scale(1.5)' }, { opacity: 0, transform: `translate(${dX}px, ${dY}px) scale(0)` }], 2000).onfinish = () => p.remove(); } }
    function createCrackers(count) { for (let i = 0; i < count; i++) { const c = document.createElement('div'); c.className = 'cracker'; c.style.backgroundColor = colors[Math.floor(Math.random()*colors.length)]; c.style.left = Math.random() * 100 + '%'; c.style.top = Math.random() * 100 + '%'; document.body.appendChild(c); const angle = Math.random() * Math.PI * 2; const dist = Math.random() * 1000 + 300; const dX = Math.cos(angle) * dist; const dY = Math.sin(angle) * dist; c.animate([{ transform: `rotate(${angle}rad) translate(0,0) scaleY(1.5)`, opacity: 1 }, { transform: `rotate(${angle}rad) translate(${dX}px, ${dY}px) scaleY(0)`, opacity: 0 }], { duration: 900, easing: 'ease-out' }).onfinish = () => c.remove(); } }
    function openView(id, m) { document.getElementById('gift-selection').style.display = 'none'; document.getElementById(id).style.display = 'block'; if(id === 'letter-view') typeL(); if(m) { music.play(); musicCanvas.style.opacity = "1"; } }
    function backToGifts() { music.pause(); music.currentTime = 0; musicCanvas.style.opacity = "0"; document.getElementById('letter-view').style.display = 'none'; document.getElementById('password-view').style.display = 'none'; document.getElementById('music-view').style.display = 'none'; document.getElementById('gift-selection').style.display = 'block'; }
    function typeL() { const t = "My Dearest Archana,\n\nI am so lucky to have you. You make everything better. Happy Valentine's Day! \n\nForever yours,\nBibin ‚ù§Ô∏è"; const el = document.getElementById('typed-letter'); el.innerHTML = ""; let i = 0; const int = setInterval(() => { if(i < t.length) { el.innerHTML += t[i] === '\n' ? '<br>' : t[i]; i++; } else clearInterval(int); }, 50); }
</script>
</body>
</html>
